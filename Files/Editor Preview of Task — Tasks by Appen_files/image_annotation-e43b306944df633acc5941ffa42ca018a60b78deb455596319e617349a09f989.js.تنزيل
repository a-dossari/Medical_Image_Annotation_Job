function ImageAnnotation(t,e){function i(t){this.id=t}function o(t,i,o){this.drawingTools=[],this.id=i,this.instance=o;for(var a=0,n=null,s=0;s<t.length;s++)this.drawingTools.push(P(t[s],this.id,this.instance));this.getActiveTool=function(){return this.drawingTools[a]},this.areToolsEnabled=function(){return null==n},this.setActiveTool=function(t){for(var e=0;e<this.drawingTools.length;e++)this.drawingTools[e].getToolType()==t&&(a=e)},this.disableActiveTool=function(){null==n&&(n=new e.Tool),n.activate()},this.enableActiveTool=function(){null!=n&&(n.remove(),n=null),this.drawingTools[a].tool.activate()}}function a(t,i){this.tool=new e.Tool,this.instance=i,this.id=t;var o=C.DEFAULT;this.tool.onMouseDown=function(t){},this.tool.onMouseDrag=function(t){},this.tool.onMouseMove=function(t){},this.tool.onMouseUp=function(t){},this.toHtml=function(){},this.toPathListHtml=function(t){},this.showHtml=function(){},this.hideHtml=function(){},this.previewPaths=function(t){},this.getToolType=function(){return o}}function n(t,i){this.tool=new e.Tool,this.instance=i,this.id=t;var o=C.LINE,a=this,n=null,s=null,r=null;this.getToolType=function(){return o},this.tool.onMouseDown=function(t){a.instance;r=null,n=null,s=new e.Path.Circle({center:[t.point.x,t.point.y],fillColor:"#f6771a",radius:a.Constants.POINT_RADIUS}),s.data.lineType=a.Constants.LINE_END_PATH,e.project.view.draw()},this.tool.onMouseMove=function(t){},this.tool.onMouseDrag=function(t){null!=n&&n.remove(),null!=r&&r.remove(),n=new e.Path({segments:[[s.segments[1].point.x,s.segments[0].point.y],[t.point.x,t.point.y]],strokeColor:"#f6771a",closed:!1}),n.data.lineType=a.Constants.LINE_MAIN_PATH,r=new e.Path.Circle({center:[t.point.x,t.point.y],fillColor:"#f6771a",radius:a.Constants.POINT_RADIUS}),r.data.lineType=a.Constants.LINE_END_PATH},this.tool.onMouseUp=function(t){var e=a.instance;null!=s&&null!=r&&null!=n?(s.data.lineID=n.id,r.data.lineID=n.id,n.data.mainID=n.id,e.core.addNewPath(s,o),e.core.addNewPath(r,o),e.core.addNewPath(n,o),e.undoRedo.saveCPState()):(null!=s&&s.remove(),null!=r&&r.remove(),null!=n&&n.remove())}}function s(t,i){this.tool=new e.Tool,this.instance=i,this.id=t;var o=C.DOT,a=this,n=this.Constants.DEFAULT_RADIUS,s=null;this.getRadius=function(){return n},this.getToolType=function(){return o},this.tool.onMouseDown=function(t){s=new e.Path.Circle({center:t.point,radius:n,fillColor:new e.Color(1,0,1),strokeColor:new e.Color(1,1,1)}),s.data.radius=n,e.project.view.draw()},this.tool.onMouseMove=function(t){},this.tool.onMouseDrag=function(t){},this.tool.onMouseUp=function(t){var e=a.instance;e.core.addNewPath(s,o),e.undoRedo.saveCPState()}}function r(t,i){this.tool=new e.Tool,this.instance=i,this.id=t;var o=C.BRUSH,a=this,n=[],s=null,r=null,d=this.Constants.LARGE_RADIUS,l=null,h=function(){return 2*d*.1},c=h();this.getToolType=function(){return o},this.getRadius=function(){return d},this.setSmallRadius=function(){d=this.Constants.SMALL_RADIUS,c=h()},this.setMediumRadius=function(){d=this.Constants.MEDIUM_RADIUS,c=h()},this.setMediumLargeRadius=function(){d=this.Constants.MEDIUM_LARGE_RADIUS,c=h()},this.setLargeRadius=function(){d=this.Constants.LARGE_RADIUS,c=h()},this.tool.onMouseDown=function(t){n=[],s=new e.Path({segments:[t.point],strokeWidth:2*d,strokeCap:"round",clockwise:!0,strokeColor:new e.Color(.3,1,1,.5),strokeJoin:"round"}),s.data.radius=d,r=s,e.project.view.draw()},this.tool.onMouseDrag=function(t){s.add(t.point),null!=l&&l.remove(),l=new e.Path.Circle({center:t.point,radius:d,fillColor:new e.Color(.3,1,1,.3)})},this.tool.onMouseMove=function(t){null!=l&&l.remove(),l=new e.Path.Circle({center:t.point,radius:d,fillColor:new e.Color(.3,1,1,.3)})},this.tool.onMouseUp=function(t){var e=a.instance;l.remove(),s.segments.length>1&&(s.closed=!1,s.simplify(),s.flatten(20),e.core.addNewPath(s,o),e.undoRedo.saveCPState())}}function d(t,i){this.tool=new e.Tool,this.instance=i,this.id=t;var o=this,a=C.POLYGON,n=this.Constants.FREE_DRAW_DRAWING_MODE,s=this.Constants.POLYGON_DRAWING_TYPE,r=n,d=null,l=null,h=null,c=null,u={segments:!0,stroke:!0,fill:!0,tolerance:5};this.getMode=function(){return n},this.getType=function(){return s},this.getToolType=function(){return a},this.setFreeDrawMode=function(){n=this.Constants.FREE_DRAW_DRAWING_MODE},this.setSelectionMode=function(){n=this.Constants.SELECTION_DRAWING_MODE},this.setNoDrawingMode=function(){n=this.Constants.NO_DRAWING_MODE},this.setModeFromPrevMode=function(){n=r},this.setPolygonDrawingType=function(){s=this.Constants.POLYGON_DRAWING_TYPE},this.setHoleDrawingType=function(){s=this.Constants.HOLE_DRAWING_TYPE},this.setPrevMode=function(){r=n},this.tool.onMouseUp=function(t){var e=o.instance;if(n==o.Constants.FREE_DRAW_DRAWING_MODE){d.segments.length;d.simplify(),d.flatten(20),d.fullySelected=!0,d.closed=!0,d.clockwise=!0,d.data.saved=!1,s==o.Constants.POLYGON_DRAWING_TYPE?d.data.drawing_type=o.Constants.POLYGON_DRAWING_TYPE:d.data.drawing_type=o.Constants.HOLE_DRAWING_TYPE,0!=d.area&&(e.core.addNewPath(d,a),e.undoRedo.saveCPState())}else(h=o.Constants.SELECTION_FILL_MOVEMENT)?(e.undoRedo.saveCPState(),h=null):(h=o.Constants.SELECTION_VERTEX_MOVEMENT)?(e.undoRedo.saveCPState(),h=null):(h=o.Constants.SELECTION_VERTEX_CREATION)&&(e.undoRedo.saveCPState(),h=null)},this.tool.onMouseDown=function(t){o.instance;if(n==o.Constants.SELECTION_DRAWING_MODE){c=d=null;var i=e.project.hitTest(t.point,u);if(!i)return;if(t.modifiers.shift)return;if(i)if(d=i.item,"segment"==i.type&&d.parent==e.project.activeLayer&&d.data.toolType==C.POLYGON)h=o.Constants.SELECTION_VERTEX_MOVEMENT,c=i.segment;else if("stroke"==i.type&&d.parent==e.project.activeLayer&&d.data.toolType==C.POLYGON){h=o.Constants.SELECTION_VERTEX_CREATION;var a=i.location;c=d.insert(a.index+1,t.point)}l="fill"==i.type,l&&d&&d.parent==e.project.activeLayer&&d.data.toolType==C.POLYGON&&(e.project.activeLayer.addChild(i.item),h=o.Constants.SELECTION_FILL_MOVEMENT)}else n==o.Constants.FREE_DRAW_DRAWING_MODE&&(d=new e.Path({segments:[t.point],fullySelected:!0}),e.project.view.draw())},this.tool.onMouseDrag=function(t){var i=o.instance;n==o.Constants.SELECTION_DRAWING_MODE&&d.parent==e.project.activeLayer?(c&&(c.point=t.point,i.menu.drawPathList()),l&&d.parent==e.project.activeLayer&&(d.position=d.position.add([t.delta.x,t.delta.y]))):n==o.Constants.FREE_DRAW_DRAWING_MODE&&d.add(t.point)},this.tool.onMouseMove=function(t){e.project.activeLayer.selected=!1,t.item&&null!=t.item.fillColor&&t.item.parent==e.project.activeLayer&&(t.item.selected=!0)}}function l(t,e){this.id=t,this.instance=e,this.img=null}function h(e,i){this.id=e,this.instance=i;var o=null,a=[],n=[],s=[];this.resetActiveObject=function(){activeObject=s[o]},this.addToObjectList=function(t){s.push(t)},this.getObjectList=function(){return s},this.getActiveObjectIndex=function(){return o},this.getActiveObject=function(){return null!=o?s[o]:null},this.setActiveObjectIndex=function(t){if(!(t>=0&&t<s.length))return null;o=t},this.getCreatedPaths=function(){return a},this.setCreatedPaths=function(t){a=t},this.getCompletedObjects=function(){return n},this.setCompletedObjects=function(e){var i=JSON.stringify(e);n=e,t(".hidden_field.ia_"+this.id).attr("value",i)}}function c(t,e){this.id=t,this.instance=e}function u(t,e){this.id=t,this.instance=e;var i=null,o=null;this.getEditPaths=function(){return o},this.setEditPaths=function(t){o=t},this.getPreviewLayer=function(){return i},this.setPreviewLayer=function(t){i=t}}function _(t,e){this.id=t,this.instance=e;var i=[[]],o=0;this.getSavedCPStatesIndex=function(){return o},this.setSavedCPStatesIndex=function(t){o=t},this.canUndo=function(){return o<i.length-1},this.canRedo=function(){return o>0},this.getSavedCPStates=function(){return i},this.setSavedCPStates=function(t){i=t}}function p(t){var i=null;return e.projects.each(function(e,o){"ia_container ia_"+o==t&&(i=o)}),i}function f(i){var o=null;return e.projects.each(function(e,a){t(i).attr("class").split(" ").each(function(t){if(t=="ia_"+a)return o=a})}),o}function v(){var o=0;t(".ia_initialize").each(function(a,n){o+=1,t(n).find("canvas").attr("id","ia_canvas_"+a),t(n).find(".ia_tools").addClass("ia_"+a);var s=document.getElementById("ia_canvas_"+a);e.setup(s);var r=new i(a),d=t(".ia_tools.ia_"+a).data("ia-tools").split(" ");w.push(r),r.createSystems(d),t(n).find("div, img, input").each(function(e,i){t(i).addClass("ia_"+a)}),t(n).find("img").attr("id","ia_imgurl_"+a),r.menu.initMenu(),r.menu.addToolsToMenu(),iaImg=t(n).find("img"),iaImg[0].width>0?m(r,a):iaImg.on("load",function(){m(r,a)})}),o>0&&g(0)}function m(e,i){e.canvasCore.renderImageBackground(i);var o=t("input.hidden_field.image-annotation.ia_"+i)[0],a=t(".metadata.ia_"+i).data("rendering-missed"),n=t(".ia_container.ia_"+i).closest(".missed").find(".judgment_data")[0];if(t(".cml_gold_reason").parent().css("height","103px"),t(".cml_gold_reason").css("margin","0"),null!=n){var s=n.data("judgment-data"),r=t.parseJSON(o.value);r[0].paths=e.saveLoad.afterJsonPathsConversion(r[0].paths),s[0].paths=e.saveLoad.afterJsonPathsConversion(s[0].paths),1==r.length&&(e.saveLoad.missedGoldFromJSONsingleObject(r[0],s[0]),e.menu.disableDrawingTools()),t(".cf_action_list.ia_"+i).remove()}else if(1==a){if(t(".cml_gold_tolerance").remove(),o.value.length>0){var r=t.parseJSON(o.value);if(r[0].paths=e.saveLoad.afterJsonPathsConversion(r[0].paths),1==r.length)e.saveLoad.missedGoldFromJSONsingleObject(r[0],null),e.menu.disableDrawingTools();else{var d=[].concat(r);d.reverse(),d.pop(),d.reverse();for(var l=0;l<d.length;l++)d[l][0].paths=e.saveLoad.afterJsonPathsConversion(d[l][0].paths);e.saveLoad.missedGoldFromJSONJudgmentOverlay(r[0],d),e.menu.disableDrawingTools()}}t(".cf_action_list.ia_"+i).remove()}else""!==o.value?(e.saveLoad.JsonToObjectList(o.value),e.core.enableDrawingForObject(0),e.menu.drawCurrentObjPathList(),e.undoRedo.saveCPState()):(e.core.fillSingleObjectList(),e.core.setCompletedObjects(e.core.getObjectList()),e.core.enableDrawingForObject(0),e.menu.drawCurrentObjPathList());t("#ia_canvas_"+i).fadeIn()}function g(t){t>=0&&t<w.length&&(e.project=e.projects[t],w[t].menu.areToolsEnabled()?w[t].menu.enableActiveTool():w[t].menu.disableActiveTool(),T=t)}var w=[],T=0,C={DEFAULT:"default",BRUSH:"brush",DOT:"dot",LINE:"line",POLYGON:"polygon"};i.prototype.createSystems=function(t){this.core=new h(this.id,w[this.id]),this.canvasCore=new l(this.id,w[this.id]),this.undoRedo=new _(this.id,w[this.id]),this.preview=new u(this.id,w[this.id]),this.saveLoad=new c(this.id,w[this.id]),this.menu=new o(t,this.id,w[this.id])};var P=function(t,e,i){return t==C.POLYGON?new d(e,i):t==C.BRUSH?new r(e,i):t==C.LINE?new n(e,i):t==C.DOT?new s(e,i):new a(e,i)};o.prototype.getTool=function(t){for(var e=0;e<this.drawingTools.length;e++)if(this.drawingTools[e].getToolType()==t)return this.drawingTools[e];return null},o.prototype.redrawActiveTool=function(){for(var e="",i=this.getActiveTool().getToolType(),o=0;o<this.drawingTools.length;o++)e=t(".cf_action_list.ia_"+this.id+" .ia_"+this.drawingTools[o].getToolType()+"_tool"),i==this.drawingTools[o].getToolType()?(e.removeClass("off"),e.addClass("on")):(e.removeClass("on"),e.addClass("off"))},o.prototype.initMenu=function(){t(".ia_container.ia_"+this.id).prepend(this.toHtml())},o.prototype.addToolsToMenu=function(){for(var e="",i=(t(".cf_action_list.ia_"+this.id),0);i<this.drawingTools.length;i++)e+=this.instance.core.makeHtmlForInstance(function(e,i,o){var a="<div>"+e+"</div>";return a=t(a).find("*").each(function(e,o){t(o).addClass("dm_"+i)}),a=t("<div>").append(a[0]).clone().html(),"<div class='ia_"+o+"_tool'>"+a+"</div>"}(this.drawingTools[i].toHtml(),i,this.drawingTools[i].getToolType()));t(".cf_action_list.ia_"+this.id).prepend(e)},o.prototype.toHtml=function(){var t="";return t+="<div class='cf_action_list ia_"+this.id+"'>",t+="<div class='finished_msg'>",t+="Saved",t+="</div>",t+="<div class='cf_object_list'>",t+="<div class='path_list_title_container ia_"+this.id+"'>",t+="<div class='path_list_title_text large_long_t_text ia_"+this.id+"'>",t+="Drawn",t+="</div>",t+="</div>",t+="<div class='cf_path_list'>",t+="</div>",t+="</div>",t+="<div class='cf_undo'>",t+="Undo (ctrl + z)",t+="</div>",t+="<div class='cf_redo'>",t+="Redo (ctrl + y)",t+="</div>",t+="<div class='render_holes'>",t+="Preview",t+="</div>",t+="<div class='edit_holes'>",t+="Back",t+="</div>",t+="<div class='done_drawing'>",t+="Save",t+="</div>",t+="<div class='done_drawing_preview'>",t+="Save",t+="</div>",t+="</div>"},o.prototype.showDrawingTools=function(){this.enableActiveTool(),this.redrawActiveTool();for(var e=0;e<this.drawingTools.length;e++)this.drawingTools[e].showHtml();t(".cf_action_list.ia_"+this.id+" .render_holes").fadeIn(),t(".cf_action_list.ia_"+this.id+" .done_drawing").fadeIn(),this.instance.undoRedo.redrawUndoRedoLinks(),t(".cf_action_list.ia_"+this.id+" .cf_undo").fadeIn(),t(".cf_action_list.ia_"+this.id+" .cf_redo").fadeIn(),t(".cf_action_list.ia_"+this.id+" .cf_object_list").fadeIn(),t(".cf_action_list.ia_"+this.id+" .cf_path_list").fadeIn()},o.prototype.disableDrawingTools=function(){for(var e=0;e<this.drawingTools.length;e++)this.drawingTools[e].hideHtml();t(".cf_action_list.ia_"+this.id+" .cf_redo").hide(),t(".cf_action_list.ia_"+this.id+" .cf_undo").hide(),t(".cf_action_list.ia_"+this.id+" .done_drawing").hide(),t(".edit_previous_object.ia_"+this.id).hide(),t(".cf_action_list.ia_"+this.id+" .cf_object_list").hide(),this.disableActiveTool()},o.prototype.drawPathList=function(){this.drawCurrentObjPathList()},o.prototype.drawCurrentObjPathList=function(){var e=this.instance.core.getCreatedPaths(),i=t(".cf_action_list.ia_"+this.id+" .cf_path_list");if(i.html(""),e.length>0)for(var o=0;o<e.length;o++)this.instance.menu.appendToPathList(e[o],o);else i.append("<div class='cf_empty_path_list'>0 Drawn</div>")},o.prototype.generatePLElementHTML=function(t,e){if(t.data.toolType){return this.instance.menu.getTool(t.data.toolType).toPathListHtml(t,e)}},o.prototype.drawObjectList=function(){this.instance.core.getObjectList()},o.prototype.appendToObjectList=function(e,i){var o,a=(this.instance.core.getActiveObjectIndex(),e.name);o="<div class='object ia_"+this.id+"' id='"+i+"' name='"+a+"'></div>",t(".cf_action_list.ia_"+this.id+" .cf_object_list").append(o);t(".object").attr("id",i).append("<div class='cf_path_list'></div>")},o.prototype.appendToPathList=function(e,i){t(".cf_action_list.ia_"+this.id+" .cf_object_list .cf_path_list").prepend(this.instance.menu.generatePLElementHTML(e,i))},o.prototype.getToolFromHtml=function(e){for(var i=0,o=this.drawingTools,a=0;a<o.length;a++)t(e).attr("class").split(" ").each(function(t){if(t=="dm_"+a)return i=a,o[i]});return o[i]},a.prototype.saveColorPath=function(t){t.fillColor=new e.Color(.06,.69,.36,.8)},a.prototype.removePath=function(t){t.remove()},a.prototype.goldColorPath=function(t){t.fillColor=new e.Color(1,.5,0,.7)},a.prototype.highlightColorPath=function(t){t.fillColor=new e.Color(0,0,0,.3)},a.prototype.colorPath=function(t){t.fillColor=new e.Color(1,0,0,.2)},a.prototype.removePathFromPathList=function(t){var e=this.instance.core.getCreatedPaths(),i=[];return e.each(function(e,o){e.id==t.id||i.push(e)}),i},n.prototype=new a,n.prototype.constructor=n,n.prototype.Constants={POINT_RADIUS:3,LINE_END_PATH:"line end point",LINE_MAIN_PATH:"line main path"},n.prototype.highlightColorPath=function(t){var i=this.instance.core.getCreatedPaths(),o=this.findEndPaths(t,i);o.length>0&&(o[0].fillColor=new e.Color(0,0,0,.3),o[1].fillColor=new e.Color(0,0,0,.3)),t.strokeColor=new e.Color(0,0,0,.3)},n.prototype.backFromHighlightColorPath=function(t){var e=this.instance.core.getCreatedPaths(),i=this.findEndPaths(t,e);i.length>0&&(i[0].fillColor="#f6771a",i[1].fillColor="#f6771a"),t.strokeColor="#f6771a"},n.prototype.removePathFromPathList=function(t){var e=this.instance.core.getCreatedPaths(),i=[],o=t.data.mainID;return e.each(function(e,a){e.id==t.id||e.data.lineID&&e.data.lineID==o||i.push(e)}),i},n.prototype.findEndPaths=function(t,e){for(var i=[],o=t.data.mainID,a=0;a<e.length;a++)if(e[a].data.lineID&&e[a].data.lineID==o){if(0!=i.length){i.push(e[a]);break}i.push(e[a])}return i},n.prototype.removePath=function(t){var e=this.instance.core.getCreatedPaths(),i=this.findEndPaths(t,e);i.length>0&&(i[1].remove(),i[0].remove()),t.remove()},n.prototype.colorPath=function(t){t.data.lineType==this.Constants.LINE_MAIN_PATH?t.strokeColor="#f6771a":t.fillColor="#f6771a"},n.prototype.goldColorPath=function(t){t.strokeColor=new e.Color(1,.5,0,.7)},n.prototype.saveColorPath=function(t){t.strokeColor=new e.Color(.06,.69,.36,.8)},n.prototype.toHtml=function(){var t="";return t+="<div class='line_container'>",t+="<div class='tool_title_container'>",t+="<div class='tool_title_text large_med_t_text'>",t+="Line",t+="</div>",t+="</div>",t+="<div class='tool_content_container'>",t+="<div class='line_radius_container'>",t+="<div class='line_radius_1'>",t+="</div>",t+="</div>",t+="<div class='line_line_container'>",t+="<div class='line_line'>",t+="</div>",t+="</div>",t+="<div class='line_radius_container'>",t+="<div class='line_radius_2'>",t+="</div>",t+="</div>",t+="</div>",t+="</div>"},n.prototype.toPathListHtml=function(t,e){if(t.data.lineType==this.Constants.LINE_MAIN_PATH){var i="<div class='highlight_path line_path ia_"+this.id+"' id='"+e+"'> Line</div>",o="<div class='delete_path ia_"+this.id+"' id='"+e+"'>x</div>";return"<div class='single_path ia_"+this.id+"'>"+i+o+"</div>"}return""},n.prototype.showHtml=function(){t(".ia_line_tool.ia_"+this.id).fadeIn(),t(".line_container.ia_"+this.id).fadeIn()},n.prototype.hideHtml=function(){t(".ia_line_tool.ia_"+this.id).hide(),t(".line_container.ia_"+this.id).hide()},n.prototype.previewPaths=function(t){for(var i=[],o=0,a=0;a<t.length;a++)t[a].data.lineType==this.Constants.LINE_MAIN_PATH&&(i[o]=new e.Path({segments:t[a].segments,closed:!1}),i[o].data=t[a].data,i[o].data.stateType==this.instance.core.Constants.REGULAR_STATE_TYPE?this.saveColorPath(i[o]):this.instance.core.colorPath(i[o]),i[o].clockwise=!0,o++);for(var a=0;a<t.length;a++)t[a].data.lineType==this.Constants.LINE_MAIN_PATH&&(2==this.findEndPaths(t[a],this.instance.core.getCreatedPaths()).length?this.instance.core.deletePath(t[a]):t[a].remove());return i},s.prototype=new a,s.prototype.constructor=s,s.prototype.genCenterFromPath=function(t){var i=0,o=0;return t.segments[1].point.x==t.segments[3].point.x?(i=t.segments[1].point.x,o=t.segments[0].point.y):(i=t.segments[0].point.x,o=t.segments[1].point.y),new e.Point(i,o)},s.prototype.Constants={DEFAULT_RADIUS:3},s.prototype.toHtml=function(){var t="";return t+="<div class='dot_container'>",t+="<div class='tool_title_container'>",t+="<div class='tool_title_text large_short_t_text'>",t+="Dot",t+="</div>",t+="</div>",t+="<div class='tool_content_container'>",t+="<div class='dot_radius d_on' ></div>",t+="</div>",t+="</div>"},s.prototype.toPathListHtml=function(t,e){var i="<div class='highlight_path dot_path ia_"+this.id+"' id='"+e+"'> D "+e+"</div>",o="<div class='delete_path ia_"+this.id+"' id='"+e+"'>x</div>";return"<div class='single_path ia_"+this.id+"'>"+i+o+"</div>"},s.prototype.showHtml=function(){this.getRadius()==this.Constants.DEFAULT_RADIUS&&t(".dot_radius.ia_"+this.id).addClass("d_on"),t(".ia_dot_tool.ia_"+this.id).fadeIn(),t(".dot_container.ia_"+this.id).fadeIn(),t(".dot_radius.ia_"+this.id).fadeIn()},s.prototype.hideHtml=function(){t(".ia_dot_tool.ia_"+this.id).hide(),t(".dot_container.ia_"+this.id).hide(),t(".dot_radius.ia_"+this.id).hide()},s.prototype.previewPaths=function(t){for(var i=[],o=0;o<t.length;o++)i[o]=new e.Path.Circle({center:this.genCenterFromPath(t[o]),radius:t[o].data.radius}),i[o].data=t[o].data,i[o].data.stateType==this.instance.core.Constants.REGULAR_STATE_TYPE?this.saveColorPath(i[o]):this.instance.core.colorPath(i[o]),i[o].clockwise=!0;for(var o=0;o<t.length;o++)this.instance.core.deletePath(t[o]);return i},s.prototype.colorPath=function(t){t.fillColor=new e.Color(1,0,1),t.strokeColor=new e.Color(1,1,1)},s.prototype.backFromHighlightColorPath=function(t){t.fillColor=new e.Color(1,0,1,.5)},s.prototype.highlightColorPath=function(t){t.fillColor=new e.Color(0,0,0,.3)},s.prototype.saveColorPath=function(t){t.fillColor=new e.Color(.06,.69,.36,.8)},r.prototype=new a,r.prototype.constructer=r,r.prototype.Constants={SMALL_RADIUS:5,MEDIUM_RADIUS:10,MEDIUM_LARGE_RADIUS:15,LARGE_RADIUS:20},r.prototype.toHtml=function(){var t="";return t+="<div class='brush_container'>",t+="<div class='tool_title_container'>",t+="<div class='tool_title_text large_long_t_text'>",t+="Brush",t+="</div>",t+="</div>",t+="<div class='tool_content_container'>",t+="<div class='small_radius b_off'></div>",t+="<div class='medium_radius b_on'></div>",t+="<div class='medium_large_radius b_off'></div>",t+="<div class='large_radius b_off'></div>",t+="</div>",t+="</div>"},r.prototype.toPathListHtml=function(t,e){var i="<div class='highlight_path brush_path ia_"+this.id+"' id='"+e+"'> B "+e+"</div>",o="<div class='delete_path ia_"+this.id+"' id='"+e+"'>x</div>";return"<div class='single_path ia_"+this.id+"'>"+i+o+"</div>"},r.prototype.showHtml=function(){var e=this.getRadius(),i=this.id;e==this.Constants.SMALL_RADIUS?(t(".medium_large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".small_radius.ia_"+i).removeClass("b_off").addClass("b_on")):e==this.Constants.MEDIUM_RADIUS?(t(".small_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_radius.ia_"+i).removeClass("b_off").addClass("b_on")):e==this.Constants.MEDIUM_LARGE_RADIUS?(t(".small_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_large_radius.ia_"+i).removeClass("b_off").addClass("b_on")):e==this.Constants.LARGE_RADIUS&&(t(".small_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".medium_large_radius.ia_"+i).removeClass("b_on").addClass("b_off"),t(".large_radius.ia_"+i).removeClass("b_off").addClass("b_on")),t(".ia_brush_tool.ia_"+i).fadeIn(),t(".brush_container.ia_"+i).fadeIn(),t(".medium_radius.ia_"+i).fadeIn(),t(".medium_large_radius.ia_"+i).fadeIn(),t(".large_radius.ia_"+i).fadeIn(),t(".small_radius.ia_"+i).fadeIn()},r.prototype.hideHtml=function(){t(".ia_brush_tool.ia_"+this.id).hide(),t(".brush_container.ia_"+this.id).hide(),t(".medium_radius.ia_"+this.id).hide(),t(".medium_large_radius.ia_"+this.id).hide(),t(".large_radius.ia_"+this.id).hide(),t(".small_radius.ia_"+this.id).hide()},r.prototype.previewPaths=function(t){for(var i=[],o=0;o<t.length;o++)i[o]=new e.Path(t[o].segments),i[o].data=t[o].data,i[o].data.stateType==this.instance.core.Constants.REGULAR_STATE_TYPE?this.saveColorPath(i[o]):this.instance.core.colorPath(i[o]),i[o].clockwise=!0;for(var o=0;o<t.length;o++)this.instance.core.deletePath(t[o]);return i},r.prototype.colorPath=function(t){t.strokeColor=new e.Color(.3,1,1,.5),t.strokeCap="round",t.strokeWidth=2*t.data.radius,t.strokeJoin="round"},r.prototype.goldColorPath=function(t){t.strokeColor=new e.Color(1,.5,0,.7),t.strokeWidth=2*t.data.radius,t.strokeCap="round",t.strokeJoin="round"},r.prototype.backFromHighlightColorPath=function(t){t.strokeColor=new e.Color(.3,1,1,.5),t.strokeCap="round",t.strokeWidth=2*t.data.radius,t.strokeJoin="round"},r.prototype.highlightColorPath=function(t){t.strokeColor=new e.Color(0,0,0,.3),t.strokeCap="round",t.strokeWidth=2*t.data.radius,t.strokeJoin="round"},r.prototype.saveColorPath=function(t){t.strokeColor=new e.Color(.06,.69,.36,.8),t.strokeCap="round",t.strokeWidth=2*t.data.radius,t.strokeJoin="round"},d.prototype=new a,d.prototype.constructor=d,d.prototype.Constants={FREE_DRAW_DRAWING_MODE:"free draw",POLYGON_DRAWING_TYPE:"polygon drawing type",NO_DRAWING_MODE:"no drawing mode",HOLE_DRAWING_TYPE:"hole drawing type",SELECTION_DRAWING_MODE:"selection mode",SELECTION_VERTEX_MOVEMENT:"selection vertex movement",SELECTION_VERTEX_CREATION:"selection vertex creation",SELECTION_FILL_MOVEMENT:"selection fill movement"},d.prototype.colorPath=function(t){t.data.drawing_type==this.Constants.HOLE_DRAWING_TYPE?t.fillColor=new e.Color(1,.8,0,.2):t.fillColor=new e.Color(1,0,0,.2)},d.prototype.backFromHighlightColorPath=function(t){t.data.drawing_type==this.Constants.HOLE_DRAWING_TYPE?t.fillColor=new e.Color(1,.8,0,.2):t.fillColor=new e.Color(1,0,0,.2)},d.prototype.toHtml=function(){return htmlOutput="",htmlOutput="<div class='polygon_container'>",htmlOutput+="<div class='tool_title_container'>",htmlOutput+="<div class='tool_title_text medium_long_t_text'>",htmlOutput+="Polygon",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="<div class='tool_content_container'>",htmlOutput+="<div class='free_draw_on'>",htmlOutput+="<div class='draw_polygon'>",htmlOutput+="<div class='poly_text'>",htmlOutput+="+",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="<div class='draw_hole off'>",htmlOutput+="<div class='hole_text'>",htmlOutput+="-",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="<div class='free_draw_off'>",htmlOutput+="<div class='select_text'>",htmlOutput+="edit/move",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput+="</div>",htmlOutput},d.prototype.showHtml=function(){this.setModeFromPrevMode(),this.getMode()==this.Constants.FREE_DRAW_DRAWING_MODE?(t(".free_draw_off.ia_"+this.id).addClass("off"),t(".free_draw_on.ia_"+this.id).removeClass("off")):this.getMode()==this.Constants.SELECTION_DRAWING_MODE&&(t(".free_draw_on.ia_"+this.id).addClass("off"),t(".free_draw_off.ia_"+this.id).removeClass("off")),this.getType()==this.Constants.POLYGON_DRAWING_TYPE?(t(".draw_hole.ia_"+this.id).addClass("off"),t(".draw_polygon.ia_"+this.id).removeClass("off")):this.getType()==this.Constants.HOLE_DRAWING_TYPE&&(t(".draw_polygon.ia_"+this.id).addClass("off"),t(".draw_hole.ia_"+this.id).removeClass("off")),t(".polygon_container.ia_"+this.id).fadeIn(),t(".draw_hole.ia_"+this.id).fadeIn(),t(".draw_polygon.ia_"+this.id).fadeIn()},d.prototype.hideHtml=function(){this.setPrevMode(),this.setNoDrawingMode(),t(".polygon_container.ia_"+this.id).hide(),t(".draw_polygon.ia_"+this.id).hide(),t(".draw_hole.ia_"+this.id).hide()},d.prototype.toPathListHtml=function(t,e){if(t.data.drawing_type==this.Constants.POLYGON_DRAWING_TYPE){var i="<div class='highlight_path polygon_path ia_"+this.id+"' id='"+e+"'> P "+e+"</div>",o="<div class='delete_path polygon_path ia_"+this.id+"' id='"+e+"'>x</div>";return"<div class='single_path ia_"+this.id+"'>"+i+o+"</div>"}if(t.data.drawing_type==this.Constants.HOLE_DRAWING_TYPE){var i="<div class='highlight_path hole_path ia_"+this.id+"' id='"+e+"'> H "+e+"</div>",o="<div class='delete_path hole_path ia_"+this.id+"' id='"+e+"'>x</div>";return"<div class='single_path ia_"+this.id+"'>"+i+o+"</div>"}},d.prototype.previewPaths=function(t){var i=this.instance,o=i.menu.getTool(C.POLYGON),a=t,n=[],s=this,r=0,d=function(t){return t.segments&&t.segments.length>0||t.children&&t.children.length>0},l=[];a.each(function(t,e){t.data.drawing_type==s.Constants.POLYGON_DRAWING_TYPE&&l.push(e)});var h=[];a.each(function(t,e){t.data.drawing_type==s.Constants.HOLE_DRAWING_TYPE&&h.push(e)}),l.each(function(t){n[r]=a[t];var s=a[t].data,l=0;h.each(function(t,e){s.stateType==a[t].data.stateType&&d(n[r])&&(n[r]=n[r].subtract(a[t]),l+=1)}),0==h.length||0==l?(n[r]=new e.Path(n[r].segments),n[r].data=s,n[r].closed=!0,n[r].clockwise=!0,n[r].data.stateType==i.core.Constants.REGULAR_STATE_TYPE?o.saveColorPath(n[r]):i.core.colorPath(n[r]),r+=1):d(n[r])&&(n[r].data=s,n[r].data.stateType==i.core.Constants.REGULAR_STATE_TYPE?o.saveColorPath(n[r]):i.core.colorPath(n[r]),r+=1)});for(var c=0;c<a.length;c++)this.instance.core.deletePath(a[c]);return n},l.prototype.renderImageBackground=function(t){if(e.projects[t].activate(),this.img=new e.Raster("ia_imgurl_"+t),this.img.image.naturalWidth>0){var i={width:548,height:548},o=i.height/this.img.height,a=i.width/this.img.width;this.img.height>this.img.width?(this.img.scale(o,{x:o*this.img.width,y:o*this.img.height}),e.view.viewSize=[o*this.img.width,o*this.img.height]):(this.img.scale(a,{x:a*this.img.width,y:a*this.img.height}),e.view.viewSize=[a*this.img.width,a*this.img.height]),this.img.position=e.view.center;(new e.Layer).activate()}},h.prototype.Constants={MISSED_GOLD_STATE_TYPE:"missed gold state type",MISSED_UNIT_STATE_TYPE:"missed unit state type",JUDGMENT_OVERLAY_STATE_TYPE:"judgment overlay state type",REGULAR_STATE_TYPE:"regular state type"},h.prototype.fillSingleObjectList=function(){var t={};t.name="Single",t.paths=[],t.directions="",t.saved=!1,this.addToObjectList(t)},h.prototype.makeHtmlForInstance=function(e){var i=this.id,o="<div>"+e+"</div>";return o=t(o).find("*").each(function(e,o){t(o).addClass("ia_"+i)}),t("<div>").append(o[0]).clone().html()},h.prototype.savePathsToActiveObject=function(){var e=this.instance.core.getActiveObject();null!=e&&(e.paths=t.extend(!0,[],this.getCreatedPaths()))},h.prototype.enableDrawingForObject=function(t){this.setActiveObject(t),this.instance.menu.drawObjectList(),this.instance.menu.showDrawingTools()},h.prototype.colorPath=function(t){var i=this.instance.menu.getTool(t.data.toolType);if(t.data.stateType==this.Constants.MISSED_GOLD_STATE_TYPE)i.goldColorPath(t);else if(t.data.stateType==this.Constants.MISSED_UNIT_STATE_TYPE)i.saveColorPath(t);else if(t.data.stateType==this.Constants.JUDGMENT_OVERLAY_STATE_TYPE){var o=t.data.judgmentQueue,a=new e.Color((o%5+1)/5,(o%2+1)/2,(o%3+1)/3,.8);t.data.toolType==C.BRUSH?(t.strokeColor=a,t.strokeWidth=2*t.data.radius,t.strokeCap="round",t.strokeJoin="round"):t.fillColor=a}else t.data.toolType?i.colorPath(t):t.fillColor=new e.Color(1,0,0,.2)},h.prototype.redrawCanvas=function(){var t=e.project.activeLayer;t.removeChildren(),this.getCreatedPaths().each(function(e,i){t.addChild(e)})},h.prototype.drawingToolsFromPaths=function(e){for(var i=[],o=0;o<e.length;o++)-1==t.inArray(e[o].data.toolType,i)&&i.push(e[o].data.toolType);return i},h.prototype.pathsFromDrawingTool=function(t,e){for(var i=[],o=0;o<t.length;o++)t[o].data.toolType==e&&i.push(t[o]);return i},h.prototype.addToCreatedPaths=function(t){this.getCreatedPaths().push(t),this.instance.menu.drawCurrentObjPathList()},h.prototype.addNewPath=function(t,e){var i=this.getCreatedPaths();t.data.toolType=e,t.data.stateType=this.Constants.REGULAR_STATE_TYPE,this.colorPath(t),i.push(t),this.instance.menu.drawCurrentObjPathList()},h.prototype.setActiveObject=function(t){this.setActiveObjectIndex(t);for(var e=this.getActiveObject(),i=e.paths,o=0;o<i.length;o++)this.addPathToActiveLayer(i[o]);this.instance.menu.drawPathList()},h.prototype.deletePath=function(t){var e=(this.getCreatedPaths(),this.instance.menu.getTool(t.data.toolType)),i=e.removePathFromPathList(t);e.removePath(t),this.setCreatedPaths(i),this.instance.menu.drawPathList()},h.prototype.addPathToActiveLayer=function(t){var i=new e.Path(t.segments);i.closed=t.closed,i.data=t.data,this.colorPath(i),this.addToCreatedPaths(i)},h.prototype.deleteObject=function(t){for(var e=0;e<t.paths.length;e++)this.deletePath(t.paths[e]);!function(t){var e=[];objectList.each(function(i,o){i.name==t.name||e.push(i)}),objectList=e}(object_to_delete)},c.prototype.JsonToObjectList=function(e){for(var i=t.parseJSON(e),o=t.extend(!0,[],i),a=0;a<i.length;a++){i[a].paths=this.afterJsonPathsConversion(i[a].paths),o[a].paths=this.afterJsonPathsConversion(o[a].paths);for(var n=0;n<i[a].paths.length;n++)i[a].paths[n]=this.newPathFromObjNoShow(i[a].paths[n]),o[a].paths[n]=this.newPathFromObjNoShowNoTrans(o[a].paths[n]);i[a].saved=!1,this.instance.core.addToObjectList(i[a])}
this.instance.core.setCompletedObjects(o)},c.prototype.afterJsonPathsConversion=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i][1]);return e},c.prototype.saveDrawing=function(){g(this.id);var i=this.id,o=this.instance,a=this.instance.preview.getEditPaths(),n=this.instance.core.getActiveObject();if(null!=a)var s=JSON.stringify(a);else{o.preview.toPreview(),a=o.preview.getEditPaths();var s=JSON.stringify(a)}if(s.length>5e4)return alert("You drew too much! \nMax drawing length allowed:50000\nYour drawing length: "+s.length),o.preview.backToEdit(),!1;a.each(function(t){o.menu.getTool(t.data.toolType).saveColorPath(t)}),finalObjectPaths=[];for(var r=0;r<a.length;r++)finalObjectPaths.push(this.newPathFromObjNoShowNoTrans(a[r]));n.paths=finalObjectPaths,n.saved=!0,n.paths.each(function(t){t.data.saved=!0});for(var d=0;d<n.paths.length;d++)!function(t,o){var a=0,n={dx:0,dy:0},s=e.projects[i].view.viewSize,r=o.canvasCore.img;a=s.height>s.width?r.height/s.height:r.width/s.width,n.dx=(r.width-s.width*a)/2,n.dy=(r.height-s.height*a)/2;var d=new e.Matrix;d.scale(a);var l=new e.Matrix;l.translate(n.dx,n.dy),t.transform(l),t.transform(d)}(n.paths[d],this.instance);this.instance.core.setCompletedObjects([n]),t(".cf_action_list.ia_"+i+" .finished_msg").fadeIn();var l=t(".image_annotation_instance_gold.ia_"+i)[0];return l&&l.fireEvent("change"),!0},c.prototype.missedGoldFromJSONJudgmentOverlay=function(t,i){for(var a=null,n=[],s=0;s<t.paths.length;s++)t.paths[s].data.stateType=this.instance.core.Constants.MISSED_GOLD_STATE_TYPE,t.paths[s]=this.newPathFromObjShow(t.paths[s]);if(null!=i)for(var r=0;r<i.length;r++)for(var s=0;s<i[r][0].paths.length;s++)i[r][0].paths[s].data.stateType=this.instance.core.Constants.JUDGMENT_OVERLAY_STATE_TYPE,i[r][0].paths[s].data.judgmentQueue=r,t.paths.push(this.newPathFromObjShow(i[r][0].paths[s]));this.instance.core.addToObjectList(t),e.projects[this.id].activeLayer.removeChildren(),a=new e.Layer,e.projects[this.id].activeLayer=a;var d=this.instance.core.drawingToolsFromPaths(t.paths);this.instance.menu=new o(d,this.id,this.instance),n=[];for(var r=0;r<this.instance.menu.drawingTools.length;r++){var l=this.instance.core.pathsFromDrawingTool(t.paths,this.instance.menu.drawingTools[r].getToolType());n.push.apply(n,this.instance.menu.drawingTools[r].previewPaths(l))}return n},c.prototype.missedGoldFromJSONsingleObject=function(t,i){for(var a=null,n=[],s=0;s<t.paths.length;s++)t.paths[s].data.stateType=this.instance.core.Constants.MISSED_GOLD_STATE_TYPE,t.paths[s]=this.newPathFromObjShow(t.paths[s]);if(null!=i)for(var s=0;s<i.paths.length;s++)i.paths[s].data.stateType=this.instance.core.Constants.MISSED_UNIT_STATE_TYPE,t.paths.push(this.newPathFromObjShow(i.paths[s]));this.instance.core.addToObjectList(t),e.projects[this.id].activeLayer.removeChildren(),a=new e.Layer,e.projects[this.id].activeLayer=a;var r=this.instance.core.drawingToolsFromPaths(t.paths);this.instance.menu=new o(r,this.id,this.instance),n=[];for(var d=0;d<this.instance.menu.drawingTools.length;d++){var l=this.instance.core.pathsFromDrawingTool(t.paths,this.instance.menu.drawingTools[d].getToolType());n.push.apply(n,this.instance.menu.drawingTools[d].previewPaths(l))}return n},c.prototype.newPathFromObjShow=function(t){var i=new e.Path(t.segments);return i.data=t.data,i.data.saved=!1,this.instance.core.colorPath(i),i.closed=t.closed,i.clockwise=t.clockwise,this.transPathImgToCanvas(i),i},c.prototype.newPathFromObjNoShow=function(t){var i=new e.Layer;e.projects[this.id].setActiveLayer=i;var o=new e.Path(t.segments);return o.data=t.data,o.data.saved=!1,this.instance.core.colorPath(o),o.closed=t.closed,o.clockwise=t.clockwise,this.transPathImgToCanvas(o),i.remove(),o},c.prototype.newPathFromObjNoShowNoTrans=function(t){var i=new e.Layer;e.projects[this.id].setActiveLayer=i;var o=new e.Path(t.segments);return o.data=t.data,o.data.saved=!1,this.instance.core.colorPath(o),o.closed=t.closed,o.clockwise=t.clockwise,i.remove(),o},c.prototype.transPathImgToCanvas=function(t){var i=0,o={dx:0,dy:0},a=e.projects[this.id].view.viewSize,n=this.instance.canvasCore.img;i=n.height>n.width?a.height/n.height:a.width/n.width,o.dx=(a.width-n.width*i)/2,o.dy=(a.height-n.height*i)/2;var s=new e.Matrix;s.scale(i);var r=new e.Matrix;r.translate(o.dx,o.dy),t.transform(s),t.transform(r)},u.prototype.backToEdit=function(){var i=this.instance;g(this.id);var o=this.getPreviewLayer();o.children.each(function(t,e){t.data.saved=!1}),o.removeChildren(),o.remove(),i.core.resetActiveObject();var a=i.core.getActiveObject(),n=e.project.activeLayer;n.removeChildren(),a.paths.each(function(t,e){n.addChild(t),i.core.addToCreatedPaths(t)}),this.setEditPaths(null),i.menu.showDrawingTools(),t(".cf_action_list.ia_"+this.id+" .render_holes").fadeIn(),t(".cf_action_list.ia_"+this.id+" .edit_holes").hide(),t(".cf_action_list.ia_"+this.id+" .done_drawing_preview").hide()},u.prototype.toPreview=function(){g(this.id);var t=this.instance;tempEditPaths=[],null!=t.core.getActiveObject&&t.core.savePathsToActiveObject(),e.project.activeLayer.removeChildren(),this.setPreviewLayer(new e.Layer),this.getPreviewLayer().activate(),tempEditPaths=[];for(var i=0;i<t.menu.drawingTools.length;i++){var o=t.core.pathsFromDrawingTool(t.core.getCreatedPaths(),t.menu.drawingTools[i].getToolType());tempEditPaths.push.apply(tempEditPaths,t.menu.drawingTools[i].previewPaths(o))}return this.setEditPaths(tempEditPaths),tempEditPaths},_.prototype.undoCPState=function(){var t=this.getSavedCPStatesIndex(),e=this.getSavedCPStates();if(this.canUndo()){t+=1,this.setSavedCPStatesIndex(t);var i=this.makeNewPathList(e[t]);this.instance.core.setCreatedPaths(i)}},_.prototype.redoCPState=function(){var t=this.getSavedCPStatesIndex(),e=this.getSavedCPStates();if(this.canRedo()){t-=1,this.setSavedCPStatesIndex(t);var i=this.makeNewPathList(e[t]);this.instance.core.setCreatedPaths(i)}},_.prototype.makeNewPathList=function(t){for(var i=[],o=0;o<t.length;o++){var a=new e.Path(t[o].segments);a.data=t[o].data,this.instance.core.colorPath(a),a.clockwise=!0,a.closed=t[o].closed,i.push(a)}return i},_.prototype.saveCPState=function(){var i=this.getSavedCPStates(),o=this.getSavedCPStatesIndex();e.projects[this.id].activeLayer.removeChildren();for(var a=0,n=t.extend(!0,[],this.instance.core.getCreatedPaths()),s=(t.extend(!0,[],i),this.makeNewPathList(n));a!=o;)i.shift(),a+=1;o=0,i.unshift(n),this.setSavedCPStates(i),this.setSavedCPStatesIndex(o),this.instance.core.setCreatedPaths(s),this.instance.core.redrawCanvas(),this.redrawUndoRedoLinks()},_.prototype.redrawUndoRedoLinks=function(){this.canUndo()?(t(".cf_action_list.ia_"+this.id+" .cf_undo").removeClass("disabled"),t(".cf_action_list.ia_"+this.id+" .cf_undo").addClass("enabled")):(t(".cf_action_list.ia_"+this.id+" .cf_undo").removeClass("enabled"),t(".cf_action_list.ia_"+this.id+" .cf_undo").addClass("disabled")),this.canRedo()?(t(".cf_action_list.ia_"+this.id+" .cf_redo").removeClass("disabled"),t(".cf_action_list.ia_"+this.id+" .cf_redo").addClass("enabled")):(t(".cf_action_list.ia_"+this.id+" .cf_redo").removeClass("enabled"),t(".cf_action_list.ia_"+this.id+" .cf_redo").addClass("disabled"))},t(function(){v()}),t.each(C,function(e,i){t(".ia_container").on("click",".ia_"+i+"_tool",function(){var t=f(this),e=w[t].menu.getTool(i);w[t].menu.setActiveTool(e.getToolType()),w[t].menu.enableActiveTool(),w[t].menu.redrawActiveTool()})}),t(".ia_container").on("click",".draw_polygon",function(){var e=f(this),i=w[e].menu.getToolFromHtml(this);w[e].menu.setActiveTool(i.getToolType()),w[e].menu.enableActiveTool(),w[e].menu.redrawActiveTool(),w[e].menu.getToolFromHtml(this).setPolygonDrawingType(),t(".draw_hole.ia_"+e).addClass("off"),t(".draw_polygon.ia_"+e).removeClass("off")}),t(".ia_container").on("click",".free_draw_off",function(){var e=f(this),i=w[e].menu.getToolFromHtml(this);w[e].menu.setActiveTool(i.getToolType()),w[e].menu.enableActiveTool(),w[e].menu.redrawActiveTool(),w[e].menu.getToolFromHtml(this).setSelectionMode(),t(".free_draw_on.ia_"+e).addClass("off"),t(".free_draw_off.ia_"+e).removeClass("off")}),t(".ia_container").on("click",".free_draw_on",function(){var e=f(this),i=w[e].menu.getToolFromHtml(this);w[e].menu.setActiveTool(i.getToolType()),w[e].menu.enableActiveTool(),w[e].menu.redrawActiveTool(),w[e].menu.getToolFromHtml(this).setFreeDrawMode(),t(".free_draw_off.ia_"+e).addClass("off"),t(".free_draw_on.ia_"+e).removeClass("off")}),t(".ia_container").on("click",".line_draw",function(){var e=f(this),i=w[e].menu.getToolFromHtml(this);w[e].menu.setActiveTool(i.getToolType()),w[e].menu.enableActiveTool(),w[e].menu.redrawActiveTool(),t(".line_draw.ia_"+e).removeClass("off")}),t(".ia_container").on("click",".render_holes",function(){w[T].preview.toPreview(),t(".cf_action_list.ia_"+T+" .render_holes").hide(),t(".cf_action_list.ia_"+T+" .edit_holes").fadeIn(),t(".cf_action_list.ia_"+T+" .done_drawing_preview").fadeIn(),w[T].menu.disableDrawingTools()}),t(".ia_container").on("click",".edit_holes",function(){w[T].preview.backToEdit()}),t(".ia_container").on("click",".draw_hole",function(){var e=f(this),i=w[e].menu.getToolFromHtml(this);w[e].menu.setActiveTool(i.getToolType()),w[e].menu.enableActiveTool(),w[e].menu.redrawActiveTool(),w[e].menu.getToolFromHtml(this).setHoleDrawingType(),t(".draw_polygon.ia_"+e).addClass("off"),t(".draw_hole.ia_"+e).removeClass("off")}),t(".ia_container").on("click",".cf_undo",function(){w[T].undoRedo.undoCPState(),w[T].core.redrawCanvas(),w[T].menu.drawPathList(),w[T].undoRedo.redrawUndoRedoLinks()}),t(document).on("keydown",function(e){t(".cf_action_list.ia_"+T+" .cf_undo").is(":visible")&&t(".ia_container.ia_"+T).is(":hovering")&&w[T].undoRedo.canUndo()&&90==e.which&&e.ctrlKey&&(w[T].undoRedo.undoCPState(),w[T].core.redrawCanvas(),w[T].menu.drawPathList(),w[T].undoRedo.redrawUndoRedoLinks())}),t(".ia_container").on("click",".cf_redo",function(){w[T].undoRedo.redoCPState(),w[T].core.redrawCanvas(),w[T].menu.drawPathList(),w[T].undoRedo.redrawUndoRedoLinks()}),t(document).on("mouseenter",".ia_container",function(){t(this).data("hovering",!0)}),t(document).on("mouseleave",".ia_container",function(){t(this).data("hovering",!1)}),t.expr[":"].hovering=function(e){return!!t(e).data("hovering")},t(document).on("keydown",function(e){t(".cf_action_list.ia_"+T+" .cf_redo").is(":visible")&&t(".ia_container.ia_"+T).is(":hovering")&&w[T].undoRedo.canRedo()&&89==e.which&&e.ctrlKey&&(w[T].undoRedo.redoCPState(),w[T].core.redrawCanvas(),w[T].menu.drawPathList(),w[T].undoRedo.redrawUndoRedoLinks())}),t(".ia_container").on({mouseenter:function(){var t=f(this),e=w[t],i=this.id,o=e.core.getCreatedPaths()[i];e.menu.getTool(o.data.toolType).highlightColorPath(o)},mouseleave:function(){var t=f(this),e=w[t],i=this.id,o=e.core.getCreatedPaths()[i];e.menu.getTool(o.data.toolType).backFromHighlightColorPath(o)}},".delete_path"),t(".ia_container").on("click",".delete_path",function(){var t=f(this),e=w[t],i=this.id,o=e.core.getCreatedPaths()[i];e.menu.getTool(o.data.toolType);e.core.deletePath(o),e.undoRedo.saveCPState()}),t(".ia_container").on("click",".done_drawing_preview",function(){w[T].saveLoad.saveDrawing()&&(t(".cf_action_list.ia_"+T+" .edit_holes").hide(),t(".cf_action_list.ia_"+T+" .done_drawing_preview").hide(),w[T].menu.disableDrawingTools())}),t(".ia_container").on("click",".done_drawing",function(){w[T].saveLoad.saveDrawing()&&(t(".cf_action_list.ia_"+T+" .render_holes").hide(),w[T].menu.disableDrawingTools())}),t(".ia_container").on({mouseenter:function(){var t=f(this),e=w[t],i=this.id,o=e.core.getCreatedPaths()[i];e.menu.getTool(o.data.toolType).highlightColorPath(o)},mouseleave:function(){var t=f(this),e=w[t],i=this.id,o=e.core.getCreatedPaths()[i];e.menu.getTool(o.data.toolType).backFromHighlightColorPath(o)}},".highlight_path"),t(".ia_container").on("click",".small_radius.b_off",function(){var t=f(this),e=w[t].menu.getToolFromHtml(this);w[t].menu.setActiveTool(e.getToolType()),w[t].menu.enableActiveTool(),w[t].menu.redrawActiveTool(),e.setSmallRadius(),e.showHtml()}),t(".ia_container").on("click",".medium_radius.b_off",function(){var t=f(this),e=w[t].menu.getToolFromHtml(this);w[t].menu.setActiveTool(e.getToolType()),w[t].menu.enableActiveTool(),w[t].menu.redrawActiveTool(),e.setMediumRadius(),e.showHtml()}),t(".ia_container").on("click",".medium_large_radius.b_off",function(){var t=f(this),e=w[t].menu.getToolFromHtml(this);w[t].menu.setActiveTool(e.getToolType()),w[t].menu.enableActiveTool(),w[t].menu.redrawActiveTool(),e.setMediumLargeRadius(),e.showHtml()}),t(".ia_container").on("click",".large_radius.b_off",function(){var t=f(this),e=w[t].menu.getToolFromHtml(this);w[t].menu.setActiveTool(e.getToolType()),w[t].menu.enableActiveTool(),w[t].menu.redrawActiveTool(),e.setLargeRadius(),e.showHtml()}),t(".ia_container").on("mouseenter",function(){g(p(t(this).attr("class")))})}var ia=new ImageAnnotation(jQuery,paper);define("image-annotation",function(){});